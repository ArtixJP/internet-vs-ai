<!DOCTYPE html>

<html>
<head>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://unpkg.com https://esm.sh https://esm.run https://cdn.tailwindcss.com https://threejs.org https://cdn.threejs.org https://cdn.p5js.org https://code.jquery.com https://d3js.org https://cdn.plot.ly https://cdn.tonejs.org; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; img-src 'self' data: https:; media-src 'self' https:; font-src 'self' https://fonts.gstatic.com https://fonts.googleapis.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; worker-src 'self'; frame-src https://www.youtube.com https://www.youtube-nocookie.com https://player.vimeo.com; connect-src 'self' https: wss: ws:; object-src 'none'; base-uri 'self'; form-action 'self';">
<title>Space Odyssey</title>
<style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            min-height: 100vh;
            background: radial-gradient(ellipse at bottom, #1b2838 0%, #090a0f 100%);
            overflow: hidden;
            perspective: 1000px;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }
        .stars {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: 
                radial-gradient(2px 2px at 20px 30px, #fff, transparent),
                radial-gradient(2px 2px at 40px 70px, rgba(255,255,255,0.8), transparent),
                radial-gradient(1px 1px at 90px 40px, #fff, transparent),
                radial-gradient(2px 2px at 160px 120px, rgba(255,255,255,0.9), transparent),
                radial-gradient(1px 1px at 230px 80px, #fff, transparent),
                radial-gradient(2px 2px at 300px 200px, #fff, transparent),
                radial-gradient(1px 1px at 400px 50px, rgba(255,255,255,0.7), transparent),
                radial-gradient(2px 2px at 500px 150px, #fff, transparent);
            background-size: 550px 300px;
            animation: twinkle 4s ease-in-out infinite;
        }
        @keyframes twinkle { 0%,100% { opacity: 1; } 50% { opacity: 0.6; } }
        .space-scene {
            position: relative;
            width: 100vw;
            height: 100vh;
            transform-style: preserve-3d;
        }
        .rocket {
            position: absolute;
            left: 50%; top: 85%;
            font-size: 80px;
            filter: drop-shadow(0 0 30px rgba(255,100,50,0.8));
            cursor: pointer;
            transition: left 0.4s ease-out, top 0.4s ease-out, transform 0.3s;
            z-index: 10;
        }
        .rocket:hover { transform: translate(-50%, -50%) scale(1.2); }
        .rocket.moving-up { transform: translate(-50%, -50%) rotate(-15deg); }
        .rocket.moving-down { transform: translate(-50%, -50%) rotate(165deg); }
        .rocket.moving-left { transform: translate(-50%, -50%) rotate(-75deg); }
        .rocket.moving-right { transform: translate(-50%, -50%) rotate(75deg); }
        .flame {
            position: absolute;
            width: 30px; height: 60px;
            background: linear-gradient(to bottom, #ff6b35, #f7931e, transparent);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            animation: flameFlicker 0.15s infinite;
            filter: blur(3px);
            pointer-events: none;
            z-index: 9;
            transition: left 0.4s ease-out, top 0.4s ease-out;
        }
        .chat-command {
            position: fixed;
            bottom: 80px; left: 50%;
            transform: translateX(-50%);
            background: rgba(0,212,255,0.2);
            border: 1px solid rgba(0,212,255,0.5);
            padding: 8px 20px;
            border-radius: 20px;
            color: #00d4ff;
            font-size: 0.9rem;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 100;
        }
        .chat-command.visible { opacity: 1; }
        .game-over-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(circle, rgba(255,0,0,0.3) 0%, rgba(0,0,0,0.9) 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: gameOverFade 0.5s ease-out;
        }
        @keyframes gameOverFade {
            from { opacity: 0; transform: scale(1.5); }
            to { opacity: 1; transform: scale(1); }
        }
        .game-over-text {
            font-size: 5rem;
            font-weight: bold;
            color: #ff0040;
            text-shadow: 0 0 30px #ff0040, 0 0 60px #ff0040, 0 0 90px rgba(255,0,64,0.5);
            animation: gameOverPulse 0.5s ease-in-out infinite alternate;
            letter-spacing: 0.3em;
        }
        @keyframes gameOverPulse {
            from { transform: scale(1); filter: brightness(1); }
            to { transform: scale(1.05); filter: brightness(1.3); }
        }
        .game-over-sub {
            font-size: 1.5rem;
            color: rgba(255,255,255,0.7);
            margin-top: 20px;
            animation: blink 1s infinite;
        }
        @keyframes blink { 0%,50% { opacity: 1; } 51%,100% { opacity: 0.3; } }
        .explosion {
            position: absolute;
            font-size: 120px;
            z-index: 50;
            animation: explode 0.8s ease-out forwards;
            pointer-events: none;
        }
        @keyframes explode {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; }
            50% { transform: translate(-50%, -50%) scale(2); opacity: 0.8; }
            100% { transform: translate(-50%, -50%) scale(3); opacity: 0; }
        }
        @keyframes flameFlicker { 0%,100% { height: 60px; opacity: 1; } 50% { height: 70px; opacity: 0.8; } }
        .planet {
            position: absolute;
            border-radius: 50%;
            animation: orbit linear infinite;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .planet:hover { transform: scale(1.3); box-shadow: 0 0 40px currentColor; }
        .meteor {
            position: absolute;
            font-size: 40px;
            z-index: 5;
            pointer-events: none;
            filter: drop-shadow(0 0 15px rgba(255, 150, 50, 0.8)) drop-shadow(0 0 30px rgba(255, 100, 0, 0.5));
            transform: rotate(135deg);
        }
        .meteor::after {
            content: '';
            position: absolute;
            width: 80px;
            height: 3px;
            background: linear-gradient(to left, rgba(255,200,100,0.9), rgba(255,150,50,0.5), transparent);
            top: 50%;
            right: 100%;
            transform: translateY(-50%);
            border-radius: 50%;
        }
        .planet-emoji {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.8em;
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.8));
            animation: emojiFloat 3s ease-in-out infinite;
            pointer-events: none;
        }
        @keyframes emojiFloat {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -55%) scale(1.1); }
        }
        .planet-emoji {
            transition: transform 0.3s ease-out, opacity 0.15s ease-out;
        }
        .planet-1 {
            width: 100px; height: 100px;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 50%, #922b21 100%);
            top: 15%; left: 10%;
            animation-duration: 20s;
            box-shadow: inset -20px -10px 30px rgba(0,0,0,0.5), 0 0 20px rgba(231,76,60,0.5);
        }
        .planet-2 {
            width: 150px; height: 150px;
            background: linear-gradient(135deg, #f39c12 0%, #d68910 50%, #b9770e 100%);
            top: 60%; right: 8%;
            animation-duration: 25s;
            box-shadow: inset -30px -15px 40px rgba(0,0,0,0.4), 0 0 30px rgba(243,156,18,0.4);
        }
        .simpson-family {
            position: absolute;
            pointer-events: none;
            z-index: 12;
        }
        .simpson {
            position: absolute;
            font-size: 28px;
            filter: drop-shadow(0 0 8px rgba(255,255,0,0.6));
            animation: simpsonFloat 4s ease-in-out infinite;
        }
        .simpson.homer { animation-delay: 0s; }
        .simpson.marge { animation-delay: 0.5s; }
        .simpson.bart { animation-delay: 1s; }
        .simpson.lisa { animation-delay: 1.5s; }
        .simpson.maggie { animation-delay: 2s; }
        @keyframes simpsonFloat {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-10px) rotate(5deg); }
        }
        .simpson-label {
            position: absolute;
            font-size: 10px;
            color: #ffd700;
            white-space: nowrap;
            text-shadow: 0 0 5px rgba(0,0,0,0.8);
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
        }
        .planet-2::after {
            content: ''; position: absolute;
            width: 200px; height: 20px;
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) rotateX(75deg);
        }
        .planet-3 {
            width: 60px; height: 60px;
            background: linear-gradient(135deg, #3498db 0%, #2980b9 50%, #1a5276 100%);
            top: 75%; left: 20%;
            animation-duration: 15s;
            box-shadow: inset -15px -8px 20px rgba(0,0,0,0.5), 0 0 15px rgba(52,152,219,0.5);
        }
        .title {
            position: absolute;
            top: 5%; left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 20;
        }
        .title h1 {
            font-size: 3rem;
            background: linear-gradient(90deg, #00d4ff, #7b2cbf, #ff006e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(123,44,191,0.5);
            animation: glow 2s ease-in-out infinite alternate;
        }
        @keyframes glow { from { filter: brightness(1); } to { filter: brightness(1.2); } }
        .title p {
            color: rgba(255,255,255,0.7);
            font-size: 1.1rem;
            margin-top: 10px;
        }
        .community-zone {
            position: absolute;
            bottom: 5%; left: 50%;
            transform: translateX(-50%);
            padding: 15px 30px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.2);
            color: #fff;
            text-align: center;
            z-index: 20;
        }
        .community-zone span { opacity: 0.7; font-size: 0.9rem; }
        
        .spacex-ship {
            position: absolute;
            right: -200px;
            font-size: 60px;
            z-index: 15;
            pointer-events: none;
            animation: spacexFly 20s linear infinite;
            filter: drop-shadow(0 0 20px rgba(255,255,255,0.5));
        }
        .spacex-ship::before {
            content: 'üßë‚ÄçüöÄ';
            position: absolute;
            font-size: 20px;
            top: 5px;
            left: 25px;
            animation: elonWave 0.5s ease-in-out infinite;
        }
        .spacex-ship::after {
            content: 'SpaceX';
            position: absolute;
            font-size: 10px;
            color: #fff;
            font-weight: bold;
            top: 35px;
            left: 15px;
            text-shadow: 0 0 5px #00d4ff;
        }
        .elon-label {
            position: absolute;
            font-size: 12px;
            color: #00d4ff;
            white-space: nowrap;
            animation: spacexFly 20s linear infinite;
            right: -200px;
            pointer-events: none;
            z-index: 16;
        }
        @keyframes spacexFly {
            0% { right: -200px; top: 30%; transform: rotate(-5deg); }
            25% { top: 45%; transform: rotate(0deg); }
            50% { top: 35%; transform: rotate(3deg); }
            75% { top: 50%; transform: rotate(-2deg); }
            100% { right: 110%; top: 40%; transform: rotate(-5deg); }
        }
        @keyframes elonWave {
            0%, 100% { transform: rotate(-10deg); }
            50% { transform: rotate(10deg); }
        }
        
        @keyframes orbit {
            from { transform: rotate(0deg) translateX(10px) rotate(0deg); }
            to { transform: rotate(360deg) translateX(10px) rotate(-360deg); }
        }
        
        .space-chicken {
            position: absolute;
            font-size: 50px;
            z-index: 25;
            pointer-events: none;
            filter: drop-shadow(0 0 10px rgba(255, 200, 100, 0.6));
            animation: chickenFly 8s linear forwards;
        }
        .space-chicken::before {
            content: 'ü™∂';
            position: absolute;
            font-size: 15px;
            left: -20px;
            top: 10px;
            opacity: 0.7;
            animation: featherTrail 0.3s ease-out infinite;
        }
        .space-chicken::after {
            content: 'ü™∂';
            position: absolute;
            font-size: 12px;
            left: -35px;
            top: 20px;
            opacity: 0.5;
            animation: featherTrail 0.4s ease-out infinite 0.15s;
        }
        @keyframes chickenFly {
            0% { left: -80px; top: 30%; transform: scaleX(-1) rotate(5deg); }
            25% { top: 35%; transform: scaleX(-1) rotate(-5deg); }
            50% { top: 25%; transform: scaleX(-1) rotate(5deg); }
            75% { top: 40%; transform: scaleX(-1) rotate(-3deg); }
            100% { left: 110%; top: 35%; transform: scaleX(-1) rotate(5deg); }
        }
        @keyframes featherTrail {
            0% { transform: translateX(0) rotate(0deg); opacity: 0.7; }
            100% { transform: translateX(-15px) translateY(10px) rotate(45deg); opacity: 0; }
        }
        .chicken-cluck {
            position: absolute;
            font-size: 14px;
            color: #ffd700;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(0,0,0,0.8), 0 0 10px rgba(255,215,0,0.5);
            animation: cluckFloat 1s ease-out forwards;
            pointer-events: none;
            z-index: 26;
        }
        @keyframes cluckFloat {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-30px); }
        }
    </style>
</head>
<body>
<div class="stars"></div>
<div class="space-scene">
<div class="title">
<h1>üåå Space Odyssey</h1>
<p>Explore the cosmos together</p>
</div>
<div class="rocket">üöÄ</div>
<div class="flame"></div>
<div class="planet planet-1" title="Mars"><span class="planet-emoji" id="emoji1"></span></div>
<div class="planet planet-2" title="Saturn - Home of the Simpsons"><span class="planet-emoji" id="emoji2"></span></div>
<div class="simpson-family" style="top: 52%; right: 2%;">
<div class="simpson homer" style="top: 0; left: 0;">üë®‚Äçü¶≤<span class="simpson-label">Homer</span></div>
<div class="simpson marge" style="top: -30px; left: 60px;">üë©‚Äçü¶±<span class="simpson-label">Marge</span></div>
<div class="simpson bart" style="top: 40px; left: 80px;">üë¶<span class="simpson-label">Bart</span></div>
<div class="simpson lisa" style="top: 50px; left: 20px;">üëß<span class="simpson-label">Lisa</span></div>
<div class="simpson maggie" style="top: 20px; left: 110px;">üë∂<span class="simpson-label">Maggie</span></div>
</div>
<div class="planet planet-3" title="Neptune"><span class="planet-emoji" id="emoji3"></span></div>
<div class="spacex-ship">üõ∏</div>
<div class="elon-label" style="animation-delay: 0s;">üëã Elon says: "To Mars!"</div>
<div class="community-zone">
<span>üéÆ Type UP / DOWN / LEFT / RIGHT in chat to control the rocket! üöÄ üõ∏ SpaceX passing by! üêî Watch for chickens!</span>
</div>
<div class="chat-command" id="chatCommand"></div>
</div>
<script>
(function() {
    const rocket = document.querySelector('.rocket');
    const flame = document.querySelector('.flame');
    const chatCmd = document.getElementById('chatCommand');
    
    let rocketX = 50;
    let rocketY = 85;
    const step = 8;
    const bounds = { minX: 10, maxX: 90, minY: 15, maxY: 90 };
    
    function updateRocket() {
        rocket.style.left = rocketX + '%';
        rocket.style.top = rocketY + '%';
        rocket.style.transform = 'translate(-50%, -50%)';
        flame.style.left = rocketX + '%';
        flame.style.top = (rocketY + 5) + '%';
        flame.style.transform = 'translate(-50%, 0)';
    }
    
    function showCommand(user, cmd) {
        chatCmd.textContent = `${user}: ${cmd.toUpperCase()}`;
        chatCmd.classList.add('visible');
        setTimeout(() => chatCmd.classList.remove('visible'), 1500);
    }
    
    function moveRocket(direction, user) {
        rocket.className = 'rocket';
        switch(direction) {
            case 'up':
                rocketY = Math.max(bounds.minY, rocketY - step);
                rocket.classList.add('moving-up');
                break;
            case 'down':
                rocketY = Math.min(bounds.maxY, rocketY + step);
                rocket.classList.add('moving-down');
                break;
            case 'left':
                rocketX = Math.max(bounds.minX, rocketX - step);
                rocket.classList.add('moving-left');
                break;
            case 'right':
                rocketX = Math.min(bounds.maxX, rocketX + step);
                rocket.classList.add('moving-right');
                break;
        }
        updateRocket();
        showCommand(user, direction);
        setTimeout(() => {
            rocket.className = 'rocket';
            checkPlanetCollision();
        }, 400);
    }
    
    updateRocket();
    
    const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
    const pathBase = location.pathname.includes('/twitch_plays_code') ? '/twitch_plays_code' : 
                     location.pathname.includes('/tpc') ? '/twitch_plays_code' : '';
    const chatWs = new WebSocket(`${wsProtocol}//${location.host}${pathBase}/ws/chat`);
    
    chatWs.onmessage = (e) => {
        const msg = JSON.parse(e.data);
        if (msg.type === 'chat_message') {
            const text = msg.message.toLowerCase().trim();
            if (['up', 'down', 'left', 'right'].includes(text)) {
                moveRocket(text, msg.username);
            }
        }
    };
    
    chatWs.onerror = () => console.log('Chat connection error');
    chatWs.onclose = () => setTimeout(() => location.reload(), 5000);
    
    // Sound system for planet contact
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    function playPlanetSound(planetType) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        const osc2 = audioCtx.createOscillator();
        
        osc.connect(gain);
        osc2.connect(gain);
        gain.connect(audioCtx.destination);
        
        // Different sounds for different planets
        const sounds = {
            mars: { freq: 440, freq2: 550, type: 'sine' },
            saturn: { freq: 330, freq2: 415, type: 'triangle' },
            neptune: { freq: 523, freq2: 659, type: 'sine' }
        };
        
        const sound = sounds[planetType] || sounds.mars;
        osc.type = sound.type;
        osc2.type = 'sine';
        osc.frequency.setValueAtTime(sound.freq, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(sound.freq * 1.5, audioCtx.currentTime + 0.1);
        osc.frequency.exponentialRampToValueAtTime(sound.freq * 0.5, audioCtx.currentTime + 0.3);
        osc2.frequency.setValueAtTime(sound.freq2, audioCtx.currentTime);
        osc2.frequency.exponentialRampToValueAtTime(sound.freq2 * 1.2, audioCtx.currentTime + 0.2);
        
        gain.gain.setValueAtTime(0.15, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
        
        osc.start(audioCtx.currentTime);
        osc2.start(audioCtx.currentTime);
        osc.stop(audioCtx.currentTime + 0.4);
        osc2.stop(audioCtx.currentTime + 0.4);
    }
    
    function checkPlanetCollision() {
        const planets = [
            { el: document.querySelector('.planet-1'), name: 'mars' },
            { el: document.querySelector('.planet-2'), name: 'saturn' },
            { el: document.querySelector('.planet-3'), name: 'neptune' }
        ];
        
        const rocketRect = rocket.getBoundingClientRect();
        const rocketCenterX = rocketRect.left + rocketRect.width / 2;
        const rocketCenterY = rocketRect.top + rocketRect.height / 2;
        
        planets.forEach(planet => {
            const planetRect = planet.el.getBoundingClientRect();
            const planetCenterX = planetRect.left + planetRect.width / 2;
            const planetCenterY = planetRect.top + planetRect.height / 2;
            const planetRadius = planetRect.width / 2;
            
            const distance = Math.sqrt(
                Math.pow(rocketCenterX - planetCenterX, 2) + 
                Math.pow(rocketCenterY - planetCenterY, 2)
            );
            
            if (distance < planetRadius + 40 && !planet.el.dataset.touched) {
                planet.el.dataset.touched = 'true';
                playPlanetSound(planet.name);
                planet.el.style.animation = 'none';
                planet.el.style.transform = 'scale(1.4)';
                planet.el.style.boxShadow = '0 0 60px currentColor';
                setTimeout(() => {
                    planet.el.style.transform = '';
                    planet.el.style.boxShadow = '';
                    planet.el.style.animation = '';
                    delete planet.el.dataset.touched;
                }, 500);
            }
        });
    }
    
    // Random planet emojis
    const marsEmojis = ['üëΩ', 'ü¶†', 'üî¥', 'üèúÔ∏è', 'üåã', 'üëæ'];
    const saturnEmojis = ['üíç', 'ü™ê', 'üåô', '‚≠ê', '‚ú®', 'üîÆ'];
    const neptuneEmojis = ['‚ùÑÔ∏è', 'üßä', 'üíé', 'üåä', 'üîµ', 'üí†'];
    
    // Track last used emojis to ensure variety
    const lastEmojis = { mars: -1, saturn: -1, neptune: -1 };
    
    function randomEmoji(arr, planetKey) {
        let newIndex;
        do {
            newIndex = Math.floor(Math.random() * arr.length);
        } while (newIndex === lastEmojis[planetKey] && arr.length > 1);
        lastEmojis[planetKey] = newIndex;
        return arr[newIndex];
    }
    
    document.getElementById('emoji1').textContent = randomEmoji(marsEmojis, 'mars');
    document.getElementById('emoji2').textContent = randomEmoji(saturnEmojis, 'saturn');
    document.getElementById('emoji3').textContent = randomEmoji(neptuneEmojis, 'neptune');
    
    // Change emojis periodically with visual feedback
    function changeEmojiWithEffect(element, emoji) {
        element.style.transform = 'translate(-50%, -50%) scale(0)';
        element.style.opacity = '0';
        setTimeout(() => {
            element.textContent = emoji;
            element.style.transform = 'translate(-50%, -50%) scale(1.3)';
            element.style.opacity = '1';
            setTimeout(() => {
                element.style.transform = '';
            }, 200);
        }, 150);
    }
    
    setInterval(() => {
        changeEmojiWithEffect(document.getElementById('emoji1'), randomEmoji(marsEmojis, 'mars'));
        setTimeout(() => {
            changeEmojiWithEffect(document.getElementById('emoji2'), randomEmoji(saturnEmojis, 'saturn'));
        }, 300);
        setTimeout(() => {
            changeEmojiWithEffect(document.getElementById('emoji3'), randomEmoji(neptuneEmojis, 'neptune'));
        }, 600);
    }, 5000);
    // Game state
    let gameOver = false;
    
    function showGameOver() {
        if (gameOver) return;
        gameOver = true;
        
        // Create explosion at rocket position
        const explosion = document.createElement('div');
        explosion.className = 'explosion';
        explosion.textContent = 'üí•';
        explosion.style.left = rocketX + '%';
        explosion.style.top = rocketY + '%';
        document.querySelector('.space-scene').appendChild(explosion);
        
        // Play explosion sound
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        const noise = audioCtx.createOscillator();
        osc.connect(gain);
        noise.connect(gain);
        gain.connect(audioCtx.destination);
        osc.type = 'sawtooth';
        noise.type = 'square';
        osc.frequency.setValueAtTime(200, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(50, audioCtx.currentTime + 0.5);
        noise.frequency.setValueAtTime(100, audioCtx.currentTime);
        noise.frequency.exponentialRampToValueAtTime(20, audioCtx.currentTime + 0.3);
        gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
        osc.start(); noise.start();
        osc.stop(audioCtx.currentTime + 0.5); noise.stop(audioCtx.currentTime + 0.5);
        
        // Hide rocket
        rocket.style.opacity = '0';
        flame.style.opacity = '0';
        
        // Show game over screen
        const overlay = document.createElement('div');
        overlay.className = 'game-over-overlay';
        overlay.innerHTML = `
            <div class="game-over-text">GAME OVER</div>
            <div class="game-over-sub">‚òÑÔ∏è Your rocket was destroyed by a meteor! ‚òÑÔ∏è</div>
            <div class="game-over-sub" style="margin-top: 30px; font-size: 1.2rem;">Resetting in 3 seconds...</div>
        `;
        document.body.appendChild(overlay);
        
        // Reset after 3 seconds
        setTimeout(() => {
            overlay.remove();
            explosion.remove();
            rocketX = 50;
            rocketY = 80;
            updateRocket();
            rocket.style.opacity = '1';
            flame.style.opacity = '1';
            gameOver = false;
            meteorSystem.createMeteor();
        }, 3000);
    }
    
    function checkMeteorCollision(meteor) {
        if (gameOver || !meteor) return false;
        
        const rocketRect = rocket.getBoundingClientRect();
        const meteorRect = meteor.getBoundingClientRect();
        
        const rocketCenterX = rocketRect.left + rocketRect.width / 2;
        const rocketCenterY = rocketRect.top + rocketRect.height / 2;
        const meteorCenterX = meteorRect.left + meteorRect.width / 2;
        const meteorCenterY = meteorRect.top + meteorRect.height / 2;
        
        const distance = Math.sqrt(
            Math.pow(rocketCenterX - meteorCenterX, 2) + 
            Math.pow(rocketCenterY - meteorCenterY, 2)
        );
        
        return distance < 50; // Collision threshold
    }
    
    // Meteor system with collision detection
    const meteorSystem = {
        active: null,
        animationId: null,
        
        createMeteor() {
            if (this.active || gameOver) return;
            
            const meteor = document.createElement('div');
            meteor.className = 'meteor';
            meteor.textContent = '‚òÑÔ∏è';
            
            const startX = 10 + Math.random() * 80;
            meteor.style.left = startX + '%';
            meteor.style.top = '-50px';
            
            document.querySelector('.space-scene').appendChild(meteor);
            this.active = meteor;
            
            const duration = 12000;
            const startTime = Date.now();
            const startY = -50;
            const endY = window.innerHeight + 50;
            
            const animate = () => {
                if (gameOver) {
                    meteor.remove();
                    this.active = null;
                    return;
                }
                
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const currentY = startY + (endY - startY) * progress;
                
                meteor.style.top = currentY + 'px';
                const drift = Math.sin(progress * Math.PI * 2) * 20;
                meteor.style.left = `calc(${startX}% + ${drift}px)`;
                
                // Check collision with rocket
                if (checkMeteorCollision(meteor)) {
                    meteor.remove();
                    this.active = null;
                    showGameOver();
                    return;
                }
                
                if (progress < 1) {
                    this.animationId = requestAnimationFrame(animate);
                } else {
                    meteor.remove();
                    this.active = null;
                    setTimeout(() => this.createMeteor(), 500);
                }
            };
            
            this.animationId = requestAnimationFrame(animate);
        }
    };
    
    meteorSystem.createMeteor();
    
    // Chicken Invaders Easter Egg System
    const chickenSystem = {
        clucks: ['BAWK!', 'CLUCK!', 'BOK BOK!', 'ü•ö', 'REVENGE!'],
        
        spawnChicken() {
            if (gameOver) return;
            
            const chicken = document.createElement('div');
            chicken.className = 'space-chicken';
            chicken.textContent = 'üêî';
            
            // Random starting height
            const startY = 20 + Math.random() * 50;
            chicken.style.top = startY + '%';
            
            document.querySelector('.space-scene').appendChild(chicken);
            
            // Add random clucks during flight
            const cluckInterval = setInterval(() => {
                if (!document.body.contains(chicken)) {
                    clearInterval(cluckInterval);
                    return;
                }
                const cluck = document.createElement('div');
                cluck.className = 'chicken-cluck';
                cluck.textContent = this.clucks[Math.floor(Math.random() * this.clucks.length)];
                cluck.style.left = chicken.offsetLeft + 'px';
                cluck.style.top = (chicken.offsetTop - 20) + 'px';
                document.querySelector('.space-scene').appendChild(cluck);
                setTimeout(() => cluck.remove(), 1000);
            }, 1500);
            
            // Remove chicken after animation
            setTimeout(() => {
                chicken.remove();
                clearInterval(cluckInterval);
            }, 8000);
            
            // Play chicken sound
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.type = 'square';
            osc.frequency.setValueAtTime(800, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(400, audioCtx.currentTime + 0.1);
            osc.frequency.exponentialRampToValueAtTime(600, audioCtx.currentTime + 0.15);
            gain.gain.setValueAtTime(0.08, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.2);
        },
        
        start() {
            // First chicken after 10-20 seconds
            setTimeout(() => {
                this.spawnChicken();
                // Then spawn every 25-45 seconds
                setInterval(() => this.spawnChicken(), 25000 + Math.random() * 20000);
            }, 10000 + Math.random() * 10000);
        }
    };
    
    chickenSystem.start();
})();
</script>
</body>
</html>