<!DOCTYPE html>

<html lang="en">
<head>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://unpkg.com https://esm.sh https://esm.run https://cdn.tailwindcss.com https://threejs.org https://cdn.threejs.org https://cdn.p5js.org https://code.jquery.com https://d3js.org https://cdn.plot.ly https://cdn.tonejs.org; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; img-src 'self' data: https:; media-src 'self' https:; font-src 'self' https://fonts.gstatic.com https://fonts.googleapis.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; worker-src 'self'; frame-src https://www.youtube.com https://www.youtube-nocookie.com https://player.vimeo.com; connect-src 'self' https: wss: ws:; object-src 'none'; base-uri 'self'; form-action 'self';">
<meta charset="utf-8"/>
<title>ğŸ± Cat Paradise ğŸ±</title>
<style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            min-height: 100vh;
            background: linear-gradient(180deg, #ffecd2 0%, #fcb69f 50%, #ee9ca7 100%);
            font-family: 'Comic Sans MS', 'Chalkboard', cursive, sans-serif;
            overflow-x: hidden;
            position: relative;
        }
        
        .sky {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            z-index: 0;
        }
        
        .floating-cat {
            position: absolute;
            font-size: 3rem;
            animation: float 6s ease-in-out infinite;
            cursor: pointer;
            pointer-events: auto;
            transition: transform 0.3s;
        }
        .floating-cat:hover { transform: scale(1.3) rotate(10deg); }
        .floating-cat:nth-child(1) { top: 10%; left: 15%; animation-delay: 0s; }
        .floating-cat:nth-child(2) { top: 25%; right: 20%; animation-delay: 1s; font-size: 2.5rem; }
        .floating-cat:nth-child(3) { top: 60%; left: 8%; animation-delay: 2s; font-size: 4rem; }
        .floating-cat:nth-child(4) { top: 40%; right: 10%; animation-delay: 0.5s; }
        .floating-cat:nth-child(5) { bottom: 20%; left: 25%; animation-delay: 3s; font-size: 2rem; }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }
        
        .main-content {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
            min-height: 100vh;
        }
        
        h1 {
            font-size: 3.5rem;
            color: #5d4e60;
            text-shadow: 3px 3px 0 #fff, -1px -1px 0 #ffb6c1;
            margin-bottom: 10px;
            animation: wiggle 2s ease-in-out infinite;
        }
        
        @keyframes wiggle {
            0%, 100% { transform: rotate(-2deg); }
            50% { transform: rotate(2deg); }
        }
        
        .subtitle {
            font-size: 1.3rem;
            color: #8b7d8b;
            margin-bottom: 30px;
        }
        
        .cat-gallery {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 900px;
        }
        
        .cat-card {
            background: rgba(255,255,255,0.85);
            border-radius: 20px;
            padding: 20px;
            width: 180px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .cat-card:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }
        .cat-card.visiting {
            animation: visitBounce 0.6s ease-in-out;
        }
        .cat-card .interaction-bubble {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: #fff;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            white-space: nowrap;
            animation: bubblePop 2s forwards;
            z-index: 10;
        }
        .heart-trail {
            position: absolute;
            font-size: 1.2rem;
            pointer-events: none;
            animation: heartFloat 1.5s ease-out forwards;
        }
        @keyframes visitBounce {
            0%, 100% { transform: translateY(0) rotate(0); }
            25% { transform: translateY(-8px) rotate(-3deg); }
            75% { transform: translateY(-5px) rotate(3deg); }
        }
        @keyframes bubblePop {
            0% { opacity: 0; transform: translateX(-50%) scale(0.5); }
            15% { opacity: 1; transform: translateX(-50%) scale(1.1); }
            25% { transform: translateX(-50%) scale(1); }
            80% { opacity: 1; }
            100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
        }
        @keyframes heartFloat {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-40px) scale(0.5); }
        }
        .cat-card .emoji { font-size: 4rem; }
        .cat-card h3 { color: #5d4e60; margin: 10px 0 5px; }
        .cat-card p { font-size: 0.9rem; color: #999; }
        
        .weird-cat {
            background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 50%, #80deea 100%) !important;
            border: 3px dashed #00bcd4;
            animation: weirdPulse 2s ease-in-out infinite;
        }
        .weird-cat .emoji {
            animation: weirdSpin 4s linear infinite;
        }
        @keyframes weirdPulse {
            0%, 100% { box-shadow: 0 0 10px #00bcd4, 0 8px 25px rgba(0,0,0,0.1); }
            50% { box-shadow: 0 0 25px #00bcd4, 0 0 40px #4dd0e1, 0 8px 25px rgba(0,0,0,0.1); }
        }
        @keyframes weirdSpin {
            0% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(5deg) scale(1.1); }
            50% { transform: rotate(0deg) scale(1); }
            75% { transform: rotate(-5deg) scale(1.1); }
            100% { transform: rotate(0deg) scale(1); }
        }
        .chat-bubble {
            margin-top: 10px;
            padding: 10px 14px;
            background: linear-gradient(135deg, rgba(0,188,212,0.3) 0%, rgba(0,150,180,0.25) 100%);
            border-radius: 15px;
            border: 2px solid rgba(0,188,212,0.5);
            font-size: 0.8rem;
            color: #004d54;
            max-width: 160px;
            word-wrap: break-word;
            min-height: 24px;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 0 2px 8px rgba(0,188,212,0.3);
        }
        .chat-bubble::before {
            content: 'ğŸ’¬';
            position: absolute;
            top: -8px;
            left: 8px;
            font-size: 0.7rem;
        }
        .chat-bubble.new-message {
            animation: bubbleWiggle 0.5s ease-in-out;
        }
        #chat-cat {
            position: fixed !important;
            top: 20px;
            right: 20px;
            z-index: 1000;
            opacity: 1;
            transform: scale(1) rotate(0deg);
            pointer-events: auto;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            animation: echoGlow 2s ease-in-out infinite;
            width: 160px !important;
            padding: 15px !important;
        }
        #chat-cat.echo-visible {
            opacity: 1;
            transform: scale(1) rotate(0deg);
            pointer-events: auto;
            animation: echoAppear 0.5s ease-out, echoGlow 1s ease-in-out infinite;
        }
        @keyframes echoAppear {
            0% { transform: scale(0) rotate(-180deg); }
            50% { transform: scale(1.3) rotate(10deg); }
            100% { transform: scale(1) rotate(0deg); }
        }
        @keyframes echoGlow {
            0%, 100% { box-shadow: 0 0 20px #00bcd4, 0 0 40px rgba(0,188,212,0.5); }
            50% { box-shadow: 0 0 40px #00bcd4, 0 0 80px rgba(0,188,212,0.8), 0 0 100px rgba(77,208,225,0.4); }
        }
        @keyframes bubbleWiggle {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); background: rgba(0,188,212,0.4); }
        }
        
        .paw-prints {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            height: 60px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            pointer-events: none;
            opacity: 0.4;
        }
        .paw { font-size: 1.5rem; animation: step 1s ease-in-out infinite alternate; }
        .paw:nth-child(odd) { animation-delay: 0.5s; }
        
        @keyframes step {
            from { opacity: 0.3; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1.1); }
        }
        
        .community-zone {
            margin-top: 40px;
            padding: 25px;
            background: rgba(255,255,255,0.6);
            border-radius: 25px;
            border: 3px dashed #ffb6c1;
            max-width: 600px;
            text-align: center;
        }
        .community-zone h2 { color: #d4798b; margin-bottom: 10px; }
        
        .battle-arena {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(255,100,100,0.2) 0%, rgba(100,100,255,0.2) 100%);
            border-radius: 25px;
            border: 4px solid #ff6b6b;
            max-width: 700px;
            text-align: center;
            box-shadow: 0 0 30px rgba(255,100,100,0.3);
        }
        .battle-arena h2 {
            color: #c0392b;
            margin-bottom: 10px;
            text-shadow: 2px 2px 0 #fff;
            animation: battlePulse 1s ease-in-out infinite;
        }
        @keyframes battlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); text-shadow: 2px 2px 10px #ff6b6b; }
        }
        #battle-canvas {
            background: linear-gradient(180deg, #87ceeb 0%, #98fb98 70%, #8b4513 100%);
            border-radius: 15px;
            box-shadow: inset 0 0 30px rgba(0,0,0,0.2), 0 5px 20px rgba(0,0,0,0.3);
        }
        .battle-stats {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            margin-top: 15px;
            font-size: 1.3rem;
            font-weight: bold;
        }
        .cat-score { color: #e74c3c; }
        .dog-score { color: #3498db; }
        .hero-cat-indicator {
            background: linear-gradient(135deg, #ffd700 0%, #ff6b6b 50%, #ffd700 100%);
            padding: 8px 14px;
            border-radius: 15px;
            font-size: 0.85rem;
            color: #5d4e60;
            font-weight: bold;
            text-shadow: 1px 1px 0 #fff;
            animation: heroGlow 1s ease-in-out infinite;
            border: 2px solid #fff;
        }
        @keyframes heroGlow {
            0%, 100% { box-shadow: 0 0 10px #ffd700, 0 0 20px rgba(255,215,0,0.5); }
            50% { box-shadow: 0 0 20px #ffd700, 0 0 40px rgba(255,215,0,0.8), 0 0 60px rgba(255,107,107,0.4); }
        }
        .vs-text {
            color: #f39c12;
            font-size: 1.5rem;
            text-shadow: 2px 2px 0 #fff;
            animation: vsFlash 0.5s ease-in-out infinite alternate;
        }
        @keyframes vsFlash {
            from { transform: scale(1); }
            to { transform: scale(1.2); }
        }
        .community-zone p { color: #8b7d8b; }
        
        .game-zone {
            margin-top: 30px;
            padding: 20px;
            background: rgba(255,255,255,0.8);
            border-radius: 25px;
            border: 4px solid #ffb6c1;
            max-width: 700px;
            text-align: center;
        }
        .game-zone h2 { color: #d4798b; margin-bottom: 15px; }
        #game-canvas {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border-radius: 15px;
            cursor: none;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
        }
        .game-score {
            font-size: 1.2rem;
            color: #5d4e60;
            margin-top: 10px;
        }
        .game-cat {
            position: absolute;
            font-size: 2rem;
            transition: all 0.3s ease-out;
            pointer-events: none;
        }
    </style>
</head>
<body>
<div class="sky">
<div class="floating-cat">ğŸ˜º</div>
<div class="floating-cat">ğŸ±</div>
<div class="floating-cat">ğŸ˜¸</div>
<div class="floating-cat">ğŸ™€</div>
<div class="floating-cat">ğŸ˜»</div>
<div class="floating-cat" style="top:75%;right:30%;animation-delay:4s;font-size:2.2rem;">ğŸˆ</div>
<div class="floating-cat" style="top:15%;left:50%;animation-delay:2.5s;font-size:3.5rem;">ğŸˆâ€â¬›</div>
<div class="floating-cat" style="top:50%;left:40%;animation-delay:1.5s;font-size:2.8rem;">ğŸ˜½</div>
</div>
<div class="main-content">
<h1>ğŸ¾ Cat Paradise ğŸ¾</h1>
<p class="subtitle">Where every pixel is purrfect~</p>
<div class="arena-container" style="display:flex;flex-direction:column;align-items:center;margin-top:20px;">
<div class="spectator-row top-spectators" style="display:flex;gap:10px;margin-bottom:15px;">
</div>
<div class="arena-with-sides" style="display:flex;align-items:center;gap:15px;">
<div class="side-spectators left-side" style="display:flex;flex-direction:column;gap:10px;">
</div>
<div class="battle-arena" style="margin:0;">
<h2>âš”ï¸ Cat vs Dog Battle Arena âš”ï¸</h2>
<p style="color:#8b7d8b;margin-bottom:10px;">ğŸ± Cats defend the paradise! ğŸ• Dogs invade! Watch the epic auto-battle! âš”ï¸</p>
<canvas height="280" id="battle-canvas" width="650"></canvas>
<div class="battle-stats">
<span class="cat-score">ğŸ± Cats: <span id="cat-wins">0</span></span>
<span class="vs-text">VS</span>
<span class="dog-score">ğŸ• Dogs: <span id="dog-wins">0</span></span>
</div>
<div class="hero-cat-indicator" style="margin-top:12px;">ğŸ® HERO CAT: Type "left" or "right" in chat to control! ğŸ±â­</div>
</div>
<div class="side-spectators right-side" style="display:flex;flex-direction:column;gap:10px;">
</div>
</div>
<div class="spectator-row bottom-spectators" style="display:flex;gap:10px;margin-top:15px;">
</div>
</div>
<div class="cat-gallery" style="display:none;">
<div class="cat-card">
<div class="emoji">ğŸ˜º</div>
<h3>Whiskers</h3>
<p>Chief Nap Officer</p>
</div>
<div class="cat-card">
<div class="emoji">ğŸ˜¸</div>
<h3>Mittens</h3>
<p>Treat Inspector</p>
</div>
<div class="cat-card">
<div class="emoji">ğŸ±</div>
<h3>Shadow</h3>
<p>Box Enthusiast</p>
</div>
<div class="cat-card">
<div class="emoji">ğŸ˜»</div>
<h3>Luna</h3>
<p>Cuddle Expert</p>
</div>
<div class="cat-card">
<div class="emoji">ğŸˆ</div>
<h3>Biscuit</h3>
<p>Kneading Master</p>
</div>
<div class="cat-card">
<div class="emoji">ğŸˆâ€â¬›</div>
<h3>Pixel</h3>
<p>Keyboard Walker</p>
</div>
<div class="cat-card">
<div class="emoji">ğŸ˜½</div>
<h3>Mochi</h3>
<p>Sunbeam Chaser</p>
</div>
<div class="cat-card">
<div class="emoji">ğŸ˜¼</div>
<h3>Gizmo</h3>
<p>Zoomie Champion</p>
</div>
</div>
<div class="community-zone">
<h2>âœ¨ Community Cat Corner âœ¨</h2>
<p>ğŸ‰ The cat family is growing! 9 adorable felines now call this paradise home! ğŸ‰</p>
<p style="margin-top:10px;font-size:0.9rem;">ğŸ’¬ Echo the weird cat repeats everything from chat! ğŸ™€âœ¨</p>
<p style="margin-top:5px;font-size:0.8rem;color:#00bcd4;">ğŸ’¬ Echo shows the latest chat message! ğŸ—¨ï¸ğŸ±</p>
<p style="margin-top:3px;font-size:0.75rem;color:#ff6b6b;font-weight:bold;">ğŸ™ˆ Echo IGNORES any message with "@" in it! No mentions allowed! ğŸš«@</p>
<p style="margin-top:5px;font-size:0.75rem;color:#999;">ğŸ¾ Cat interactions now happen every 25-45 seconds for ultra zen vibes! ğŸ§˜â€â™€ï¸ğŸ¾</p>
<p style="margin-top:5px;font-size:0.8rem;color:#d4798b;">ğŸ­ Click any cat to see their mood change! Each meow brings a new expression! ğŸ˜ºğŸ˜»ğŸ˜¼</p>
<p style="margin-top:8px;font-size:0.9rem;color:#ff69b4;font-weight:bold;">ğŸ“£ The cats are now SPECTATORS around the battle arena! Cheer them on! ğŸ‰ğŸ±</p>
<p style="margin-top:5px;font-size:0.85rem;color:#ff1493;">ğŸ”Š AUTO-MEOW ENABLED! Click anywhere to start hearing the cats! ğŸ±ğŸµ</p>
<p style="margin-top:8px;font-size:0.9rem;color:#7c3aed;font-weight:bold;">ğŸµ Procedural Cat Symphony AUTO-PLAYS! Dreamy ambient music starts automatically! ğŸ¶âœ¨</p>
</div>
</div>
<div class="nyan-indicator" id="nyan-indicator" style="position:fixed;bottom:70px;right:10px;background:linear-gradient(135deg, #ff69b4 0%, #ff1493 50%, #ff69b4 100%);padding:10px 15px;border-radius:20px;font-size:0.8rem;color:#fff;z-index:100;display:flex;align-items:center;gap:8px;box-shadow:0 3px 15px rgba(255,105,180,0.5), 0 0 30px rgba(255,105,180,0.3);animation:nyanPulse 0.5s ease-in-out infinite;cursor:pointer;border:2px solid #fff;">
<span style="font-size:1.4rem;animation:nyanBounce 0.3s ease-in-out infinite alternate;">ğŸŒˆğŸ±</span>
<span style="font-weight:bold;text-shadow:1px 1px 2px rgba(0,0,0,0.3);">CUSTOM NYAN! ğŸµ</span>
<span class="sound-waves" style="display:flex;gap:3px;align-items:flex-end;height:20px;">
<span style="width:4px;height:8px;background:#fff;border-radius:2px;animation:wave1 0.3s ease-in-out infinite;"></span>
<span style="width:4px;height:14px;background:#fff;border-radius:2px;animation:wave2 0.3s ease-in-out infinite 0.1s;"></span>
<span style="width:4px;height:10px;background:#fff;border-radius:2px;animation:wave3 0.3s ease-in-out infinite 0.15s;"></span>
<span style="width:4px;height:16px;background:#fff;border-radius:2px;animation:wave1 0.3s ease-in-out infinite 0.2s;"></span>
<span style="width:4px;height:6px;background:#fff;border-radius:2px;animation:wave2 0.3s ease-in-out infinite 0.05s;"></span>
</span>
<span style="font-size:1rem;">ğŸ”Š</span>
</div>
<div id="music-indicator" onclick="toggleCatMusic()" style="position:fixed;bottom:170px;right:10px;background:linear-gradient(135deg, #a855f7 0%, #7c3aed 50%, #6366f1 100%);padding:10px 14px;border-radius:18px;font-size:0.8rem;color:#fff;z-index:100;display:flex;align-items:center;gap:8px;box-shadow:0 3px 15px rgba(139,92,246,0.5), 0 0 25px rgba(139,92,246,0.3);border:2px solid #fff;cursor:pointer;animation:musicPulse 2s ease-in-out infinite;">
<span style="font-size:1.3rem;animation:noteFloat 1s ease-in-out infinite alternate;">ğŸµ</span>
<span style="font-weight:bold;text-shadow:1px 1px 2px rgba(0,0,0,0.3);">CAT SYMPHONY</span>
<span id="music-status" style="font-size:1rem;">ğŸ”Š</span>
</div>
<div id="meow-indicator" onclick="if(typeof randomMeow!=='undefined')randomMeow();" style="position:fixed;bottom:120px;right:10px;background:linear-gradient(135deg, #ffb6c1 0%, #ff69b4 100%);padding:8px 12px;border-radius:15px;font-size:0.75rem;color:#fff;z-index:100;display:flex;align-items:center;gap:6px;box-shadow:0 3px 10px rgba(255,105,180,0.4);border:2px solid #fff;cursor:pointer;">
<span style="font-size:1.2rem;">ğŸ±</span>
<span style="font-weight:bold;">MEOWS ENABLED!</span>
<span style="font-size:0.9rem;">ğŸ”Š</span>
</div>
<div class="cat-card weird-cat" id="chat-cat" style="position:fixed;top:20px;right:20px;z-index:1000;width:160px;">
<div class="emoji" style="filter: hue-rotate(180deg) saturate(1.5);font-size:3rem;">ğŸ™€</div>
<h3>Echo</h3>
<p>Chat Mimic</p>
<div class="chat-bubble" id="echo-bubble">Waiting for chat...</div>
</div>
<div class="paw-prints">
<span class="paw">ğŸ¾</span>
<span class="paw">ğŸ¾</span>
<span class="paw">ğŸ¾</span>
<span class="paw">ğŸ¾</span>
<span class="paw">ğŸ¾</span>
<span class="paw">ğŸ¾</span>
<span class="paw">ğŸ¾</span>
</div>
<script>
        document.querySelectorAll('.cat-card').forEach(card => {
            card.addEventListener('click', () => {
                card.style.animation = 'none';
                card.offsetHeight;
                card.style.animation = 'wiggle 0.5s ease-in-out';
                
                // Mood-based meows with matching expressions
                const moodMeows = [
                    { msg: 'Meow!', emoji: 'ğŸ˜º', mood: 'happy' },
                    { msg: 'Purrrr~', emoji: 'ğŸ˜»', mood: 'love' },
                    { msg: 'Mrrp?', emoji: 'ğŸ™€', mood: 'curious' },
                    { msg: 'Nya~', emoji: 'ğŸ˜¸', mood: 'playful' },
                    { msg: '*head bonk*', emoji: 'ğŸ˜½', mood: 'affectionate' },
                    { msg: '*yawns*', emoji: 'ğŸ˜¿', mood: 'sleepy' },
                    { msg: 'HISS!', emoji: 'ğŸ™€', mood: 'angry' },
                    { msg: '*happy chirp*', emoji: 'ğŸ˜¸', mood: 'excited' },
                    { msg: '*slow blink*', emoji: 'ğŸ˜»', mood: 'trusting' },
                    { msg: 'Mrow?!', emoji: 'ğŸ™€', mood: 'surprised' },
                    { msg: '*smug look*', emoji: 'ğŸ˜¼', mood: 'smug' },
                    { msg: '*kneads paws*', emoji: 'ğŸ˜º', mood: 'content' }
                ];
                
                const choice = moodMeows[Math.floor(Math.random() * moodMeows.length)];
                const emojiEl = card.querySelector('.emoji');
                const originalEmoji = emojiEl.textContent;
                
                // Temporarily change emoji to match mood
                emojiEl.textContent = choice.emoji;
                emojiEl.style.transition = 'transform 0.3s ease';
                emojiEl.style.transform = 'scale(1.2)';
                
                // Create speech bubble with mood message
                const bubble = document.createElement('div');
                bubble.textContent = choice.msg;
                bubble.style.cssText = 'position:absolute;background:#fff;padding:8px 15px;border-radius:15px;font-size:1rem;box-shadow:0 3px 10px rgba(0,0,0,0.2);animation:fadeUp 1.5s forwards;pointer-events:none;z-index:5;';
                card.style.position = 'relative';
                card.appendChild(bubble);
                
                // Restore original emoji after animation
                setTimeout(() => {
                    bubble.remove();
                    emojiEl.style.transform = 'scale(1)';
                    setTimeout(() => {
                        emojiEl.textContent = originalEmoji;
                    }, 300);
                }, 1500);
            });
        });
        
        const style = document.createElement('style');
        style.textContent = '@keyframes fadeUp{0%{opacity:1;top:-10px;}100%{opacity:0;top:-50px;}}';
        document.head.appendChild(style);
        
        // Silent Nyan Cat styles
        const nyanStyle = document.createElement('style');
        nyanStyle.textContent = `
            @keyframes nyanBounce {
                0% { transform: translateY(0) rotate(-5deg); }
                100% { transform: translateY(-3px) rotate(5deg); }
            }
            @keyframes nyanPulse {
                0%, 100% { transform: scale(1); box-shadow: 0 3px 10px rgba(0,0,0,0.2); }
                50% { transform: scale(1.02); box-shadow: 0 3px 15px rgba(255,105,180,0.4); }
            }
            @keyframes wave1 {
                0%, 100% { height: 8px; }
                50% { height: 4px; }
            }
            @keyframes wave2 {
                0%, 100% { height: 12px; }
                50% { height: 6px; }
            }
            @keyframes wave3 {
                0%, 100% { height: 6px; }
                50% { height: 10px; }
            }
        `;
        document.head.appendChild(nyanStyle);
        
        // NYAN CAT NOW PLAYS CUSTOM MP4 AUDIO! ğŸŒˆğŸ”Š
        const nyanVideo = document.getElementById('nyan-video');
        const nyanIndicator = document.getElementById('nyan-indicator');
        if (nyanVideo) {
            nyanVideo.volume = 0.4; // Playing at 40% volume - not too loud! ğŸ”ŠğŸŒˆ
            
            // Click indicator to toggle play/pause
            if (nyanIndicator) {
                nyanIndicator.addEventListener('click', () => {
                    if (nyanVideo.paused) {
                        nyanVideo.play();
                        nyanIndicator.querySelector('span:last-child').textContent = 'ğŸ”Š';
                        nyanIndicator.querySelector('span:nth-child(2)').textContent = 'CUSTOM NYAN!';
                    } else {
                        nyanVideo.pause();
                        nyanIndicator.querySelector('span:last-child').textContent = 'ğŸ”‡';
                    }
                });
            }
            
            nyanVideo.play().catch(() => {
                console.log('Autoplay blocked - click the Nyan indicator to start!');
                if (nyanIndicator) {
                    nyanIndicator.querySelector('span:nth-child(2)').textContent = 'Click to play!';
                }
            });
        }
        
        // Distribute cat cards around the battle arena as spectators!
        const catCards = document.querySelectorAll('.cat-gallery .cat-card');
        const topRow = document.querySelector('.top-spectators');
        const bottomRow = document.querySelector('.bottom-spectators');
        const leftSide = document.querySelector('.left-side');
        const rightSide = document.querySelector('.right-side');
        
        // Distribute cards: 2 top, 3 left, 3 right, 1 bottom (more visible on sides!)
        const cardArray = Array.from(catCards);
        cardArray.forEach((card, i) => {
            card.style.width = '130px';
            card.style.padding = '10px';
            card.querySelector('.emoji').style.fontSize = '2.2rem';
            card.querySelector('h3').style.fontSize = '0.85rem';
            card.querySelector('p').style.fontSize = '0.65rem';
            
            if (i < 2) topRow.appendChild(card);
            else if (i < 5) leftSide.appendChild(card);
            else if (i < 8) rightSide.appendChild(card);
            else bottomRow.appendChild(card);
        });
        
        // Add cheering animations to spectator cards
        const spectatorStyle = document.createElement('style');
        spectatorStyle.textContent = `
            .spectator-row .cat-card, .side-spectators .cat-card {
                animation: spectatorCheer 2s ease-in-out infinite;
            }
            .left-side .cat-card { animation-delay: 0.3s; }
            .right-side .cat-card { animation-delay: 0.6s; }
            .bottom-spectators .cat-card { animation-delay: 0.9s; }
            @keyframes spectatorCheer {
                0%, 100% { transform: translateY(0) rotate(0); }
                25% { transform: translateY(-5px) rotate(-3deg); }
                75% { transform: translateY(-3px) rotate(3deg); }
            }
            .arena-container { max-width: 95vw; }
            .side-spectators .cat-card { 
                width: 125px !important; 
                background: rgba(255,255,255,0.95) !important;
                box-shadow: 0 5px 20px rgba(0,0,0,0.15) !important;
            }
            .side-spectators .emoji { font-size: 2.2rem !important; }
            .left-side, .right-side {
                padding: 10px;
                background: rgba(255,182,193,0.4);
                border-radius: 15px;
                box-shadow: 0 0 20px rgba(255,182,193,0.5);
            }
            .spectator-row .cat-card, .side-spectators .cat-card {
                border: 3px solid #ffb6c1 !important;
                box-shadow: 0 5px 25px rgba(255,105,180,0.4) !important;
            }
            .top-spectators, .bottom-spectators {
                background: rgba(255,182,193,0.3);
                padding: 10px 20px;
                border-radius: 15px;
            }
        `;
        document.head.appendChild(spectatorStyle);
        
        // Cat Card Interactions System
        const allCatCards = document.querySelectorAll('.cat-card');
        const interactions = [
            ['ğŸ’•', 'ğŸ˜» So cute!'],
            ['ğŸŸ', 'Want some fish?'],
            ['ğŸ’­', 'Thinking of you~'],
            ['ğŸ§¶', "Let's play!"],
            ['ğŸ˜´', 'Nap together?'],
            ['ğŸ¾', '*paw bump*'],
            ['ğŸ’–', 'Best friends!'],
            ['ğŸŒŸ', 'You shine!'],
            ['ğŸ£', 'Sushi time!'],
            ['ğŸ€', 'Looking fancy~'],
            ['ğŸŒ™', 'Moon gazing?'],
            ['â˜€ï¸', 'Sunny vibes!'],
            ['ğŸ¦‹', 'Chase butterflies!'],
            ['ğŸµ', '*purrs a melody*'],
            ['ğŸ§', 'Sweet like you!'],
            ['ğŸª´', 'Plant nibbling?'],
            ['ğŸ“¦', 'Box party!'],
            ['ğŸ§£', 'Cozy times~'],
            ['ğŸ', 'Surprise gift!'],
            ['ğŸƒ', 'Leaf attack!'],
            ['ğŸ‘€', '*stares intensely*'],
            ['ğŸ­', 'Mouse spotted!'],
            ['ğŸŒˆ', 'Rainbow dreams~'],
            ['â­', 'Starlight friend!'],
            ['ğŸª', 'Circus tricks!'],
            ['ğŸ›‹ï¸', 'Couch conquest!'],
            ['ğŸª', 'Mirror enemy!'],
            ['ğŸ­', 'Drama queen!'],
            ['ğŸ§Š', 'Ice cube chase!'],
            ['ğŸ“º', 'Bird TV time!'],
            ['ğŸ¸', 'Rock meow!'],
            ['ğŸ•', 'Pizza slice!'],
            ['ğŸŒº', 'Flower crown!'],
            ['ğŸ¦´', 'Dog impressions!'],
            ['ğŸˆ', 'Balloon pop!'],
            ['ğŸ§²', 'Magnet paws!'],
            ['ğŸ””', '*ding ding*'],
            ['ğŸ’¤', 'Sleepy boi~'],
            ['ğŸŒŠ', 'Water fear!'],
            ['ğŸ†', 'Champion cat!']
        ];
        
        function createHeartTrail(fromCard, toCard) {
            const fromRect = fromCard.getBoundingClientRect();
            const toRect = toCard.getBoundingClientRect();
            
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    const heart = document.createElement('span');
                    heart.className = 'heart-trail';
                    heart.textContent = 'ğŸ’•';
                    heart.style.left = (fromRect.left + fromRect.width/2 + (toRect.left - fromRect.left) * (i/3)) + 'px';
                    heart.style.top = (fromRect.top + (toRect.top - fromRect.top) * (i/3)) + 'px';
                    document.body.appendChild(heart);
                    setTimeout(() => heart.remove(), 1500);
                }, i * 200);
            }
        }
        
        function catInteraction() {
            const cards = Array.from(allCatCards);
            const fromIdx = Math.floor(Math.random() * cards.length);
            let toIdx = Math.floor(Math.random() * cards.length);
            while (toIdx === fromIdx) toIdx = Math.floor(Math.random() * cards.length);
            
            const fromCard = cards[fromIdx];
            const toCard = cards[toIdx];
            const [emoji, message] = interactions[Math.floor(Math.random() * interactions.length)];
            
            fromCard.classList.add('visiting');
            setTimeout(() => fromCard.classList.remove('visiting'), 600);
            
            createHeartTrail(fromCard, toCard);
            
            setTimeout(() => {
                toCard.classList.add('visiting');
                const bubble = document.createElement('div');
                bubble.className = 'interaction-bubble';
                bubble.textContent = emoji + ' ' + message;
                toCard.style.position = 'relative';
                toCard.appendChild(bubble);
                setTimeout(() => {
                    bubble.remove();
                    toCard.classList.remove('visiting');
                }, 2000);
            }, 500);
        }
        
        // ===== CAT VS DOG BATTLE SYSTEM =====
        const battleCanvas = document.getElementById('battle-canvas');
        const battleCtx = battleCanvas.getContext('2d');
        let catWins = 0;
        let dogWins = 0;
        
        const catEmojis = ['ğŸ˜º', 'ğŸ˜¸', 'ğŸ±', 'ğŸ˜»', 'ğŸˆ', 'ğŸ˜¼'];
        const dogEmojis = ['ğŸ•', 'ğŸ¶', 'ğŸ©', 'ğŸ¦®', 'ğŸ•â€ğŸ¦º', 'ğŸ¾'];
        
        class BattleUnit {
            constructor(team, x) {
                this.team = team;
                this.x = x;
                this.y = 100 + Math.random() * 120;
                this.hp = 100;
                this.maxHp = 100;
                this.speed = 0.8 + Math.random() * 0.6;
                this.attackPower = 15 + Math.random() * 10;
                this.attackCooldown = 0;
                this.emoji = team === 'cat' 
                    ? catEmojis[Math.floor(Math.random() * catEmojis.length)]
                    : dogEmojis[Math.floor(Math.random() * dogEmojis.length)];
                this.size = 28 + Math.random() * 8;
                this.bobOffset = Math.random() * Math.PI * 2;
            }
            
            update(enemies) {
                this.bobOffset += 0.1;
                if (this.attackCooldown > 0) this.attackCooldown--;
                
                // Find nearest enemy
                let nearest = null;
                let nearestDist = Infinity;
                enemies.forEach(e => {
                    const dist = Math.abs(e.x - this.x);
                    if (dist < nearestDist) {
                        nearestDist = dist;
                        nearest = e;
                    }
                });
                
                if (nearest) {
                    if (nearestDist < 40) {
                        // Attack!
                        if (this.attackCooldown <= 0) {
                            nearest.hp -= this.attackPower;
                            this.attackCooldown = 30;
                        }
                    } else {
                        // Move toward enemy
                        this.x += (this.team === 'cat' ? this.speed : -this.speed);
                    }
                } else {
                    // No enemies, advance!
                    this.x += (this.team === 'cat' ? this.speed * 0.5 : -this.speed * 0.5);
                }
            }
            
            draw(ctx) {
                const bobY = Math.sin(this.bobOffset) * 3;
                
                // Health bar
                const barWidth = 30;
                const barHeight = 4;
                ctx.fillStyle = '#333';
                ctx.fillRect(this.x - barWidth/2, this.y - 25 + bobY, barWidth, barHeight);
                ctx.fillStyle = this.team === 'cat' ? '#e74c3c' : '#3498db';
                ctx.fillRect(this.x - barWidth/2, this.y - 25 + bobY, barWidth * (this.hp / this.maxHp), barHeight);
                
                // Unit emoji
                ctx.font = `${this.size}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(this.emoji, this.x, this.y + bobY);
                
                // Attack flash
                if (this.attackCooldown > 25) {
                    ctx.font = '15px Arial';
                    ctx.fillText('ğŸ’¥', this.x + (this.team === 'cat' ? 20 : -20), this.y - 10 + bobY);
                }
            }
        }
        
        let cats = [];
        let dogs = [];
        
        // ğŸ® HERO CAT - Chat Controlled!
        const heroCat = {
            x: 100,
            y: 180,
            targetX: 100,
            hp: 200,
            maxHp: 200,
            attackPower: 25,
            attackCooldown: 0,
            emoji: 'â­ğŸ±',
            size: 38,
            bobOffset: 0,
            isHero: true,
            lastCommand: '',
            commandFlash: 0
        };
        
        function moveHeroCat(direction) {
            if (direction === 'left') {
                heroCat.targetX = Math.max(40, heroCat.x - 60);
                heroCat.lastCommand = 'â¬…ï¸ LEFT!';
            } else if (direction === 'right') {
                heroCat.targetX = Math.min(battleCanvas.width - 40, heroCat.x + 60);
                heroCat.lastCommand = 'â¡ï¸ RIGHT!';
            }
            heroCat.commandFlash = 30;
        }
        
        function updateHeroCat() {
            heroCat.bobOffset += 0.12;
            if (heroCat.commandFlash > 0) heroCat.commandFlash--;
            if (heroCat.attackCooldown > 0) heroCat.attackCooldown--;
            
            // Smooth movement toward target
            const dx = heroCat.targetX - heroCat.x;
            heroCat.x += dx * 0.15;
            
            // Attack nearby dogs
            dogs.forEach(dog => {
                const dist = Math.abs(dog.x - heroCat.x) + Math.abs(dog.y - heroCat.y);
                if (dist < 80 && heroCat.attackCooldown <= 0) {
                    dog.hp -= heroCat.attackPower;
                    heroCat.attackCooldown = 25;
                }
            });
            
            // Take damage from nearby dogs
            dogs.forEach(dog => {
                const dist = Math.abs(dog.x - heroCat.x) + Math.abs(dog.y - heroCat.y);
                if (dist < 50 && dog.attackCooldown <= 0) {
                    heroCat.hp -= 5;
                    if (heroCat.hp <= 0) heroCat.hp = heroCat.maxHp; // Respawn!
                }
            });
        }
        
        function drawHeroCat(ctx) {
            const bobY = Math.sin(heroCat.bobOffset) * 5;
            
            // Glow effect for hero
            ctx.shadowColor = '#ffd700';
            ctx.shadowBlur = 20 + Math.sin(heroCat.bobOffset * 2) * 10;
            
            // Health bar (bigger for hero)
            const barWidth = 50;
            const barHeight = 6;
            ctx.fillStyle = '#333';
            ctx.shadowBlur = 0;
            ctx.fillRect(heroCat.x - barWidth/2, heroCat.y - 35 + bobY, barWidth, barHeight);
            ctx.fillStyle = '#ffd700';
            ctx.fillRect(heroCat.x - barWidth/2, heroCat.y - 35 + bobY, barWidth * (heroCat.hp / heroCat.maxHp), barHeight);
            
            // Crown above hero
            ctx.font = '18px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('ğŸ‘‘', heroCat.x, heroCat.y - 45 + bobY);
            
            // Hero emoji
            ctx.shadowColor = '#ffd700';
            ctx.shadowBlur = 15;
            ctx.font = `${heroCat.size}px Arial`;
            ctx.fillText('ğŸ±', heroCat.x, heroCat.y + bobY);
            ctx.shadowBlur = 0;
            
            // Star sparkles
            if (Math.random() < 0.3) {
                ctx.font = '12px Arial';
                ctx.fillText('âœ¨', heroCat.x + (Math.random() - 0.5) * 40, heroCat.y + (Math.random() - 0.5) * 30 + bobY);
            }
            
            // Attack flash
            if (heroCat.attackCooldown > 20) {
                ctx.font = '20px Arial';
                ctx.fillText('ğŸ’¥', heroCat.x + 25, heroCat.y - 15 + bobY);
            }
            
            // Command indicator
            if (heroCat.commandFlash > 0) {
                ctx.font = 'bold 14px Comic Sans MS';
                ctx.fillStyle = '#ffd700';
                ctx.fillText(heroCat.lastCommand, heroCat.x, heroCat.y - 55 + bobY);
            }
            
            // Label
            ctx.font = 'bold 10px Comic Sans MS';
            ctx.fillStyle = '#ffd700';
            ctx.fillText('HERO', heroCat.x, heroCat.y + 25 + bobY);
        }
        
        function spawnUnits() {
            if (cats.length < 4) cats.push(new BattleUnit('cat', 30 + Math.random() * 50));
            if (dogs.length < 4) dogs.push(new BattleUnit('dog', battleCanvas.width - 30 - Math.random() * 50));
        }
        
        // Initial spawn
        for (let i = 0; i < 3; i++) {
            cats.push(new BattleUnit('cat', 30 + i * 40));
            dogs.push(new BattleUnit('dog', battleCanvas.width - 30 - i * 40));
        }
        
        function battleLoop() {
            battleCtx.clearRect(0, 0, battleCanvas.width, battleCanvas.height);
            
            // Draw battlefield grass
            battleCtx.fillStyle = 'rgba(34, 139, 34, 0.3)';
            for (let i = 0; i < 20; i++) {
                battleCtx.fillRect(i * 35, battleCanvas.height - 20, 3, 15);
            }
            
            // Update units
            cats.forEach(c => c.update(dogs));
            dogs.forEach(d => d.update(cats));
            
            // Remove dead units
            const deadCats = cats.filter(c => c.hp <= 0).length;
            const deadDogs = dogs.filter(d => d.hp <= 0).length;
            cats = cats.filter(c => c.hp > 0);
            dogs = dogs.filter(d => d.hp > 0);
            
            // Score updates
            if (deadDogs > 0) {
                catWins += deadDogs;
                document.getElementById('cat-wins').textContent = catWins;
            }
            if (deadCats > 0) {
                dogWins += deadCats;
                document.getElementById('dog-wins').textContent = dogWins;
            }
            
            // Update and draw hero cat
            updateHeroCat();
            drawHeroCat(battleCtx);
            
            // Draw all units
            cats.forEach(c => c.draw(battleCtx));
            dogs.forEach(d => d.draw(battleCtx));
            
            // Draw team labels
            battleCtx.font = 'bold 14px Comic Sans MS';
            battleCtx.fillStyle = '#e74c3c';
            battleCtx.textAlign = 'left';
            battleCtx.fillText('ğŸ± CAT ARMY', 10, 20);
            battleCtx.fillStyle = '#3498db';
            battleCtx.textAlign = 'right';
            battleCtx.fillText('DOG INVADERS ğŸ•', battleCanvas.width - 10, 20);
            
            requestAnimationFrame(battleLoop);
        }
        
        battleLoop();
        setInterval(spawnUnits, 3000); // Spawn new units every 3 seconds
        
        // Start cat interactions every 25-45 seconds (ultra calm mode per community request)
        setInterval(catInteraction, 25000 + Math.random() * 20000);
        setTimeout(catInteraction, 1000); // First interaction after 1 second
        
        // ğŸ”Š AUTO-PLAYING MEOW SOUNDS SYSTEM ğŸ±
        const meowContext = new (window.AudioContext || window.webkitAudioContext)();
        
        function playMeow() {
            const oscillator = meowContext.createOscillator();
            const gainNode = meowContext.createGain();
            
            // Random meow characteristics
            const baseFreq = 400 + Math.random() * 400; // 400-800 Hz range
            const meowDuration = 0.15 + Math.random() * 0.25;
            
            oscillator.connect(gainNode);
            gainNode.connect(meowContext.destination);
            
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(baseFreq, meowContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(baseFreq * 1.5, meowContext.currentTime + meowDuration * 0.3);
            oscillator.frequency.exponentialRampToValueAtTime(baseFreq * 0.7, meowContext.currentTime + meowDuration);
            
            gainNode.gain.setValueAtTime(0.15, meowContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, meowContext.currentTime + meowDuration);
            
            oscillator.start(meowContext.currentTime);
            oscillator.stop(meowContext.currentTime + meowDuration);
        }
        
        function randomMeow() {
            playMeow();
            // Sometimes double meow!
            if (Math.random() < 0.3) {
                setTimeout(playMeow, 150 + Math.random() * 100);
            }
        }
        
        // Auto-play meows every 3-8 seconds
        setInterval(() => {
            if (Math.random() < 0.7) randomMeow(); // 70% chance each interval
        }, 3000 + Math.random() * 5000);
        
        // First meow after 2 seconds
        setTimeout(randomMeow, 2000);
        
        // Click anywhere to enable audio context (browser requirement)
        document.addEventListener('click', () => {
            if (meowContext.state === 'suspended') meowContext.resume();
        }, { once: true });
        
        // ğŸµ PROCEDURAL CAT SYMPHONY - AUTO GENERATED MUSIC ğŸµ
        const musicCtx = new (window.AudioContext || window.webkitAudioContext)();
        let musicPlaying = true;
        let currentNotes = [];
        
        // Pentatonic scale for dreamy cat vibes (C major pentatonic)
        const catScale = [261.63, 293.66, 329.63, 392.00, 440.00, 523.25, 587.33, 659.25];
        const bassNotes = [130.81, 146.83, 164.81, 196.00]; // Lower octave
        
        function createDreamyPad(freq, duration, startTime) {
            const osc1 = musicCtx.createOscillator();
            const osc2 = musicCtx.createOscillator();
            const gain = musicCtx.createGain();
            const filter = musicCtx.createBiquadFilter();
            
            osc1.type = 'sine';
            osc2.type = 'triangle';
            osc1.frequency.value = freq;
            osc2.frequency.value = freq * 1.002; // Slight detune for warmth
            
            filter.type = 'lowpass';
            filter.frequency.value = 800 + Math.random() * 400;
            filter.Q.value = 1;
            
            osc1.connect(gain);
            osc2.connect(gain);
            gain.connect(filter);
            filter.connect(musicCtx.destination);
            
            // Soft attack and release
            gain.gain.setValueAtTime(0, startTime);
            gain.gain.linearRampToValueAtTime(0.06, startTime + 0.3);
            gain.gain.linearRampToValueAtTime(0.04, startTime + duration * 0.7);
            gain.gain.linearRampToValueAtTime(0, startTime + duration);
            
            osc1.start(startTime);
            osc2.start(startTime);
            osc1.stop(startTime + duration);
            osc2.stop(startTime + duration);
        }
        
        function createBell(freq, startTime) {
            const osc = musicCtx.createOscillator();
            const gain = musicCtx.createGain();
            
            osc.type = 'sine';
            osc.frequency.value = freq * 2; // Higher octave for bells
            
            osc.connect(gain);
            gain.connect(musicCtx.destination);
            
            gain.gain.setValueAtTime(0.08, startTime);
            gain.gain.exponentialRampToValueAtTime(0.001, startTime + 1.5);
            
            osc.start(startTime);
            osc.stop(startTime + 1.5);
        }
        
        function createBass(freq, startTime) {
            const osc = musicCtx.createOscillator();
            const gain = musicCtx.createGain();
            const filter = musicCtx.createBiquadFilter();
            
            osc.type = 'sine';
            osc.frequency.value = freq;
            
            filter.type = 'lowpass';
            filter.frequency.value = 200;
            
            osc.connect(gain);
            gain.connect(filter);
            filter.connect(musicCtx.destination);
            
            gain.gain.setValueAtTime(0, startTime);
            gain.gain.linearRampToValueAtTime(0.1, startTime + 0.1);
            gain.gain.linearRampToValueAtTime(0.07, startTime + 1);
            gain.gain.linearRampToValueAtTime(0, startTime + 2);
            
            osc.start(startTime);
            osc.stop(startTime + 2);
        }
        
        function generateMusicPhrase() {
            if (!musicPlaying || musicCtx.state === 'suspended') return;
            
            const now = musicCtx.currentTime;
            
            // Bass note every 2 seconds
            if (Math.random() < 0.4) {
                createBass(bassNotes[Math.floor(Math.random() * bassNotes.length)], now);
            }
            
            // Dreamy pad chord
            const rootIdx = Math.floor(Math.random() * (catScale.length - 2));
            createDreamyPad(catScale[rootIdx], 3 + Math.random() * 2, now);
            
            // Maybe add a harmony note
            if (Math.random() < 0.6) {
                createDreamyPad(catScale[rootIdx + 2], 2 + Math.random() * 1.5, now + 0.5);
            }
            
            // Bell melody notes
            if (Math.random() < 0.7) {
                const bellDelay = Math.random() * 1.5;
                createBell(catScale[Math.floor(Math.random() * catScale.length)], now + bellDelay);
            }
            
            // Second bell sometimes
            if (Math.random() < 0.4) {
                createBell(catScale[Math.floor(Math.random() * catScale.length)], now + 1 + Math.random());
            }
        }
        
        function toggleCatMusic() {
            musicPlaying = !musicPlaying;
            const statusEl = document.getElementById('music-status');
            const indicatorEl = document.getElementById('music-indicator');
            
            if (musicPlaying) {
                statusEl.textContent = 'ğŸ”Š';
                indicatorEl.style.opacity = '1';
                if (musicCtx.state === 'suspended') musicCtx.resume();
            } else {
                statusEl.textContent = 'ğŸ”‡';
                indicatorEl.style.opacity = '0.6';
            }
        }
        
        // Start the music loop
        setInterval(generateMusicPhrase, 2500 + Math.random() * 1500);
        setTimeout(generateMusicPhrase, 1000);
        
        // AUTO-PLAY: Try to resume immediately!
        function tryAutoPlay() {
            if (musicCtx.state === 'suspended') {
                musicCtx.resume().then(() => {
                    console.log('ğŸµ Cat Symphony auto-playing!');
                    document.getElementById('music-status').textContent = 'ğŸ”Š';
                }).catch(() => {
                    console.log('Auto-play blocked, waiting for interaction...');
                    document.getElementById('music-indicator').style.animation = 'musicNeedClick 0.5s ease-in-out infinite';
                });
            }
        }
        
        // Try auto-play on load
        tryAutoPlay();
        setTimeout(tryAutoPlay, 500);
        setTimeout(tryAutoPlay, 1500);
        
        // Also resume on any user interaction
        ['click', 'touchstart', 'keydown', 'scroll'].forEach(event => {
            document.addEventListener(event, () => {
                if (musicCtx.state === 'suspended') {
                    musicCtx.resume().then(() => {
                        document.getElementById('music-indicator').style.animation = 'musicPulse 2s ease-in-out infinite';
                        document.getElementById('music-status').textContent = 'ğŸ”Š';
                    });
                }
            }, { once: true });
        });
        
        // Add music animation styles
        const musicStyles = document.createElement('style');
        musicStyles.textContent = `
            @keyframes musicPulse {
                0%, 100% { transform: scale(1); box-shadow: 0 3px 15px rgba(139,92,246,0.5), 0 0 25px rgba(139,92,246,0.3); }
                50% { transform: scale(1.03); box-shadow: 0 3px 20px rgba(139,92,246,0.7), 0 0 40px rgba(139,92,246,0.5); }
            }
            @keyframes noteFloat {
                0% { transform: translateY(0) rotate(-10deg); }
                100% { transform: translateY(-3px) rotate(10deg); }
            }
            @keyframes musicNeedClick {
                0%, 100% { transform: scale(1); background: linear-gradient(135deg, #f59e0b 0%, #d97706 50%, #b45309 100%); }
                50% { transform: scale(1.08); background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 50%, #d97706 100%); }
            }
        `;
        document.head.appendChild(musicStyles);
        
        // Chat Mimic Cat - Echo!
        const echoBubble = document.getElementById('echo-bubble');
        const chatCat = document.getElementById('chat-cat');
        const echoMessages = [];
        
        let echoTimeout = null;
        
        function updateEchoBubble(message, username) {
            const displayText = username ? `${username}: ${message}` : message;
            echoBubble.textContent = displayText.substring(0, 50) + (displayText.length > 50 ? '...' : '');
            echoBubble.classList.remove('new-message');
            void echoBubble.offsetWidth; // Trigger reflow
            echoBubble.classList.add('new-message');
            
            // Clear any existing timeout
            if (echoTimeout) clearTimeout(echoTimeout);
            
            // Echo wiggles when receiving messages!
            chatCat.classList.add('visiting');
            setTimeout(() => chatCat.classList.remove('visiting'), 600);
        }
        
        // Connect to live chat WebSocket
        try {
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const pathBase = location.pathname.includes('/twitch_plays_code') ? '/twitch_plays_code' : 
                           location.pathname.includes('/tpc') ? '/twitch_plays_code' : '';
            const chatWs = new WebSocket(`${wsProtocol}//${location.host}${pathBase}/ws/chat`);
            
            chatWs.onopen = () => {
                updateEchoBubble('ğŸ¤ Connected! Say something!');
            };
            
            chatWs.onmessage = (e) => {
                const msg = JSON.parse(e.data);
                if (msg.type === 'chat_message') {
                    // ğŸ® HERO CAT CONTROLS!
                    const lowerMsg = msg.message.toLowerCase().trim();
                    if (lowerMsg === 'left' || lowerMsg === 'l') {
                        moveHeroCat('left');
                    } else if (lowerMsg === 'right' || lowerMsg === 'r') {
                        moveHeroCat('right');
                    }
                    
                    // Skip messages containing @ (mentions/commands)
                    if (msg.message && msg.message.includes('@')) {
                        // Show that we're ignoring this message!
                        echoBubble.textContent = 'ğŸ™ˆ Skipping @ message...';
                        echoBubble.classList.remove('new-message');
                        void echoBubble.offsetWidth;
                        echoBubble.classList.add('new-message');
                        return; // Echo ignores @ messages! ğŸ™€
                    }
                    echoMessages.push({message: msg.message, username: msg.username});
                    if (echoMessages.length > 20) echoMessages.shift(); // Keep last 20
                    updateEchoBubble(msg.message, msg.username);
                }
                if (msg.type === 'chat_history' && msg.messages && msg.messages.length > 0) {
                    // Only show the very last message from history
                    const lastMsg = msg.messages[msg.messages.length - 1];
                    updateEchoBubble(lastMsg.message, lastMsg.username);
                }
            };
            
            chatWs.onerror = () => {
                updateEchoBubble('ğŸ˜¿ Chat unavailable');
            };
            
            chatWs.onclose = () => {
                updateEchoBubble('ğŸ˜¿ Disconnected...');
            };
        } catch (err) {
            updateEchoBubble('ğŸ˜¿ No chat connection');
        }
    </script>
</body>
</html>